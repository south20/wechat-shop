(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["solitaire/activity/activity"],{1755:function(t,e,n){"use strict";n.r(e);var o=n("6cc2"),r=n("ceba");for(var a in r)"default"!==a&&function(t){n.d(e,t,(function(){return r[t]}))}(a);n("d9a0");var i,s=n("f0c5"),c=Object(s["a"])(r["default"],o["b"],o["c"],!1,null,"19ea6848",null,!1,o["a"],i);e["default"]=c.exports},"1f91":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=r(n("4795"));function r(t){return t&&t.__esModule?t:{default:t}}function a(t,e,n,o,r,a,i){try{var s=t[a](i),c=s.value}catch(u){return void n(u)}s.done?e(c):Promise.resolve(c).then(o,r)}function i(t){return function(){var e=this,n=arguments;return new Promise((function(o,r){var i=t.apply(e,n);function s(t){a(i,o,r,s,c,"next",t)}function c(t){a(i,o,r,s,c,"throw",t)}s(void 0)}))}}function s(t){return d(t)||l(t)||u(t)||c()}function c(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(t,e){if(t){if("string"===typeof t)return f(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(t,e):void 0}}function l(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function d(t){if(Array.isArray(t))return f(t)}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}function p(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function h(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?p(Object(n),!0).forEach((function(e){g(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function g(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}getApp();var m={data:function(){return{background:"",comment:[],page:1,order_list:[],count:0,allNum:0,allPrice:0,id:0,userInfo:{},uploadImg:[],commentText:"",commentFlag:!0,goods:"",areaInfo:"",goodsIndex:"",userid:"",min_price:"",shareimg:""}},components:{},props:{},onLoad:function(e){this.options=e,wx.setNavigationBarTitle({title:"页面标题"}),this.setTheme(),this.setData({background:t.getStorageSync("background")}),wx.setNavigationBarTitle({title:"群接龙"}),this.options.hasOwnProperty("user_id")&&wx.setStorageSync("shareInfo",{sharePeople_id:this.options.user_id,leader_id:this.options.leader_id})},onReady:function(){},onShow:function(){this.getActivityDetails(),this.shopSolitaireOrder(),this.shopSolitaireComment()},onHide:function(){},onUnload:function(){},onPullDownRefresh:function(){this.init()},onReachBottom:function(){this.shopSolitaireOrder()},onShareAppMessage:function(){return{title:"".concat(t.getStorageSync("user").nickname,"邀请你参加接龙咯"),path:"/solitaire/activity/activity?id=".concat(this.options.id,"&user_id=").concat(t.getStorageSync("user").id,"&leader_id=").concat(t.getStorageSync("area_id")),imageUrl:this.shareimg}},methods:{btnAdd:function(t){var e=this,n=this.goods;try{var o=t.currentTarget.dataset.type,r=t.currentTarget.dataset.index;"add"==o?n[r].number+=1:1!=n[r].number&&(n[r].number-=1)}catch(a){}console.log(n[0].price,n[0].number),this.setData({goods:n,allNum:n.map((function(t){return t.number})).reduce((function(t,e,n){return Number(t)+Number(e)})),allPrice:n.map((function(t){return t.stock[e.goodsIndex[t.id]].price*t.number})).reduce((function(t,e,n){return Number(t)+Number(e)}))})},init:function(){this.setData({comment:[],page:1,order_list:[],count:0})},getActivityDetails:function(){var e=this;this.http({url:"shopSolitaire/".concat(this.options.id)}).then((function(n){console.log(n),e.setData(h({},n.data,{areaInfo:t.getStorageSync("area"),goods:n.data.goods.map((function(t){return h({},t,{number:1})})),allNum:n.data.goods.length,allPrice:n.data.goods.map((function(t){return t.stock[0].price})).reduce((function(t,e,n){return Number(t)+Number(e)})),goodsIndex:Object.fromEntries(n.data.goods.map((function(t){return[t.id,0]}))),id:e.options.id,userid:t.getStorageSync("user").id,userInfo:t.getStorageSync("user"),min_price:n.data.goods.map((function(t){return s(t.stock)})).flat().sort((function(t,e){return t-e}))[0].price})),e.drawShareImage()}))},shopSolitaireComment:function(){var t=this;this.http({url:"shopSolitaireComment",data:{solitaire_id:this.options.id,limit:2,page:1}}).then((function(e){t.setData({comment:e.data})}))},shopSolitaireOrder:function(){var t=this;this.http({url:"shopSolitaireOrder/".concat(this.options.id),data:{limit:10,page:this.page}}).then((function(e){console.log(e),t.setData({order_list:[].concat(s(t.order_list),s(e.data)),page:t.page+1,count:e.count})}))},changeindex:function(t){console.log(t.currentTarget.dataset);var e=t.currentTarget.dataset.goodsid,n=t.currentTarget.dataset.stockindex,o=this.goodsIndex;o[e]=n,console.log(o),this.setData({goodsIndex:o}),this.btnAdd()},call:function(){wx.makePhoneCall({phoneNumber:t.getStorageSync("area").phone})},go:function(t){wx.navigateTo({url:t.currentTarget.dataset.url})},tobuy:function(){var e=this;console.log(this.goodsIndex,this.goods);var n=[{supplier_id:this.goods[0].supplier_id,supplier_name:0==this.goods[0].supplier_id?t.getStorageSync("shopInfo").name:this.goods[0].supplier_name,solitaire_id:this.options.id,list:this.goods.map((function(t){return console.log(t.stock[e.goodsIndex[t.id]]),{goods_id:t.id,goods_name:t.name,price:t.stock[e.goodsIndex[t.id]].price,number:t.number,weight:t.weight,total_price:t.stock[e.goodsIndex[t.id]].price*t.number,property1_name:t.stock[e.goodsIndex[t.id]].property1_name,property2_name:t.stock[e.goodsIndex[t.id]].property2_name,pic_url:t.pic_urls,stock_id:t.stock[e.goodsIndex[t.id]].stock_id,service_goods_is_ship:t.service_goods_is_ship,type:t.type}}))}];console.log(n),wx.setStorageSync("shopcartData",n),wx.navigateTo({url:"/pages/createOrder/createOrder/createOrder?solitaire=".concat(this.options.id)})},uploadFile:function(){var t=this;wx.chooseImage({complete:function(e){var n=e.tempFilePaths.map((function(e){return t.commentImageUpload(e)}));Promise.all(n).then((function(e){console.log(e),t.setData({uploadImg:e})}))}})},commentImageUpload:function(e){return new Promise((function(n){wx.uploadFile({url:"".concat(t.getStorageSync("url"),"shopGoodsCommentUploads"),filePath:e,header:{"Access-Token":t.getStorageSync("jwt")},name:"pic_url",success:function(t){n(JSON.parse(t.data).data)}})}))},writecomment:function(t){this.setData({commentText:t.detail.value})},postComment:function(){var t=this,e={solitaire_id:this.options.id,content:this.commentText,pic_urls:this.uploadImg};console.log(e),""!=e.content?this.http({url:"shopSolitaireComment",data:e,method:"post"}).then((function(e){console.log(e),t.setData({commentFlag:!0}),t.shopSolitaireComment()})):wx.showToast({title:"请填写评论",icon:"none"})},showCommentLayer:function(){this.setData({commentFlag:!1})},preImage:function(t){wx.previewImage({urls:this.pic_urls,current:t.currentTarget.dataset.pic})},drawShareImage:function(){var e=this,n=wx.createSelectorQuery();n.select("#shareimg").fields({node:!0}).exec(function(){var n=i(o.default.mark((function n(r){var a,i,c,u,l,d,f,p;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a=r[0].node,i=a.getContext("2d"),c=wx.getSystemInfoSync().pixelRatio,a.width=375,a.height=302,i.beginPath(),i.fillStyle=e.background,i.fillRect(0,0,375,302),i.closePath(),i.beginPath(),i.fillStyle="#ffffff",i.arc(10,136,10,Math.PI,1.5*Math.PI),i.arc(365,136,10,1.5*Math.PI,0),i.lineTo(375,302),i.lineTo(0,302),i.lineTo(0,136),i.fill(),i.closePath(),i.save(),i.beginPath(),i.arc(188,35,25,Math.PI,4*Math.PI),i.clip(),n.next=24,e.drawimgtocanvas(a,i,e.userInfo.avatar,{x:163,y:10,width:50,height:50});case 24:for(i.closePath(),i.restore(),i.textAlign="center",i.font="18px sans-serif",u=18,l=(e.areaInfo.area_name.length+3)/u,(e.areaInfo.area_name.length+3)%u!=0&&(l=Number.parseInt(l)+1),d=0;d<l;d++)i.fillText("".concat(e.areaInfo.area_name,"的团购接龙").substr(d*u,d*u+u),186,85+20*d);i.textAlign="left",i.font="bold 20px sans-serif",i.fillStyle="#101010",i.fillText(e.name.slice(0,13),27,160),i.fillStyle="red",i.font="bold 13px sans-serif",i.fillText("起",346,160),i.textAlign="right",i.font="bold 24px sans-serif",i.fillText(e.min_price,346,160),i.font="bold 20px sans-serif",i.fillText("￥",346-15.5*(e.min_price.length-1),160),f=s(e.goods).slice(0,3),n.t0=o.default.keys(f);case 46:if((n.t1=n.t0()).done){n.next=52;break}return p=n.t1.value,n.next=50,e.drawimgtocanvas(a,i,f[p].pic_urls,{x:21+115*p,y:188,width:103,height:103});case 50:n.next=46;break;case 52:i.save(),i.beginPath(),i.globalAlpha="0.8",i.fillStyle=e.background,i.arc(144,234,20,2.5*Math.PI,1.5*Math.PI),i.arc(232,234,20,1.5*Math.PI,2.5*Math.PI),i.lineTo(144,254),i.fill(),i.closePath(),i.restore(),i.font="bold 18px sans-serif",i.textAlign="center",i.fillStyle="#ffffff",i.fillText("我要接龙",187.5,241),wx.canvasToTempFilePath({canvas:a,width:a.width,height:a.height,destHeight:302*c,destWidth:375*c,x:0,y:0,quality:0,success:function(n){setTimeout((function(){wx.uploadFile({url:"".concat(t.getStorageSync("url"),"uploads"),filePath:n.tempFilePath,header:{"Access-Token":t.getStorageSync("jwt")},name:"pic_url",success:function(t){var n=JSON.parse(t.data);200==n.status&&e.setData({shareimg:n.data})}})}),200)}});case 67:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}())},drawimgtocanvas:function(t,e,n,r){return i(o.default.mark((function a(){return o.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.abrupt("return",new Promise((function(o){var a=t.createImage();a.src=n,a.onload=function(t){e.drawImage(a,r.x,r.y,r.width,r.height),o("绘制 ".concat(n," 完毕"))}})));case 1:case"end":return o.stop()}}),a)})))()}}};e.default=m}).call(this,n("543d")["default"])},"1fca":function(t,e,n){"use strict";(function(t){n("cd90");o(n("66fd"));var e=o(n("1755"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])},"6cc2":function(t,e,n){"use strict";var o,r=function(){var t=this,e=t.$createElement;t._self._c},a=[];n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return a})),n.d(e,"a",(function(){return o}))},bd42:function(t,e,n){},ceba:function(t,e,n){"use strict";n.r(e);var o=n("1f91"),r=n.n(o);for(var a in o)"default"!==a&&function(t){n.d(e,t,(function(){return o[t]}))}(a);e["default"]=r.a},d9a0:function(t,e,n){"use strict";var o=n("bd42"),r=n.n(o);r.a}},[["1fca","common/runtime","common/vendor"]]]);