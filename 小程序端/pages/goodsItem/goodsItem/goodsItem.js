(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/goodsItem/goodsItem/goodsItem"],{"4e9e":function(e,t,o){},"7e18":function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(o("4795")),a=o("8535");function i(e){return e&&e.__esModule?e:{default:e}}function s(e,t,o,n,a,i,s){try{var r=e[i](s),d=r.value}catch(c){return void o(c)}r.done?t(d):Promise.resolve(d).then(n,a)}function r(e){return function(){var t=this,o=arguments;return new Promise((function(n,a){var i=e.apply(t,o);function r(e){s(i,n,a,r,d,"next",e)}function d(e){s(i,n,a,r,d,"throw",e)}r(void 0)}))}}getApp();var d=function(){Promise.all([o.e("common/vendor"),o.e("pages/goodsItem/image/image")]).then(function(){return resolve(o("092b"))}.bind(null,o)).catch(o.oe)},c=function(){o.e("pages/goodsItem/footer/footer").then(function(){return resolve(o("e718"))}.bind(null,o)).catch(o.oe)},l=function(){o.e("pages/goodsItem/goodsCoupons/goodsCoupons").then(function(){return resolve(o("d6bb"))}.bind(null,o)).catch(o.oe)},u=function(){o.e("pages/goodsItem/goodsclassify/goodsclassify").then(function(){return resolve(o("16c2"))}.bind(null,o)).catch(o.oe)},g=function(){o.e("pages/goodsItem/goodsComment/goodsComment").then(function(){return resolve(o("2e97"))}.bind(null,o)).catch(o.oe)},p=function(){o.e("pages/goodsItem/store/store").then(function(){return resolve(o("51b8"))}.bind(null,o)).catch(o.oe)},h=function(){o.e("pages/login/login").then(function(){return resolve(o("c6ff"))}.bind(null,o)).catch(o.oe)},f=function(){Promise.all([o.e("common/vendor"),o.e("pages/goodsItem/layer/layer")]).then(function(){return resolve(o("7a25"))}.bind(null,o)).catch(o.oe)},m=function(){o.e("pages/footer/footer").then(function(){return resolve(o("2175"))}.bind(null,o)).catch(o.oe)},_=function(){o.e("pages/goodsItem/groupPrice/groupPrice").then(function(){return resolve(o("c65c"))}.bind(null,o)).catch(o.oe)},v=function(){Promise.all([o.e("common/vendor"),o.e("pages/goodsItem/goodsInfo/goodsInfo")]).then(function(){return resolve(o("b169"))}.bind(null,o)).catch(o.oe)},b=function(){o.e("pages/goodsItem/groupInfo/groupInfo").then(function(){return resolve(o("8ade"))}.bind(null,o)).catch(o.oe)},y=function(){o.e("pages/goodsItem/buypeople/buypeople").then(function(){return resolve(o("0f41"))}.bind(null,o)).catch(o.oe)},w=function(){o.e("pages/goodsItem/share/share").then(function(){return resolve(o("24b7"))}.bind(null,o)).catch(o.oe)},S=function(){o.e("pages/goodsItem/groupPlayer/groupPlayer").then(function(){return resolve(o("02aa"))}.bind(null,o)).catch(o.oe)},I=function(){Promise.all([o.e("common/vendor"),o.e("pages/goodsItem/groupRecommended/groupRecommended")]).then(function(){return resolve(o("9d86"))}.bind(null,o)).catch(o.oe)},x=function(){o.e("pages/utill/recommendGoods/recommendGoods").then(function(){return resolve(o("6ef7"))}.bind(null,o)).catch(o.oe)},P=function(){Promise.all([o.e("common/vendor"),o.e("pages/goodsItem/advanceInfo/advanceInfo")]).then(function(){return resolve(o("878d"))}.bind(null,o)).catch(o.oe)},k={data:function(){return{scene:"",id:"",banner:[],html:"",price:"",goodsName:"",show:!1,btnStatus:"",kdf:"",showLogin:!1,monthSale:"",copyright:"",nickName:"",stocks:0,is_flash_sale:0,line_price:"",short_name:"",max_price:"",min_price:"",end_time:"",start_time:"",send_time:"",avatar:[],totalSale:"",shareFlag:!1,video_url:"",video_pic_url:"",video_status:"",simple_info:"",interFlag:!1,is_group:!1,goodstype:0,older_with_newer:!1,property:[],tuanNum:0,submit_type:0,group_id:0,type:"0",service_goods_is_ship:"0",open_group_preferential:!1,group_type:"",attribute:[],info_bottom:"",info_header:"",supplier_id:0,supplier_name:"",appid:"",roomid:0,top:0,height:0,data:{},bg:"",look:0,l_id:"",u_id:"",label:"",is_info_header:"",shareimg:""}},components:{goodsimage:d,goodsfooter:c,goodsCoupons:l,goodsclassify:u,goodsComment:g,store:p,login:h,layer:f,footer:m,goodsPrice:_,goodsInfo:v,groupInfo:b,buyPeople:y,Share:w,groupPlayer:S,groupRecommended:I,recommendGoods:x,advanceInfo:P},props:{},onLoad:function(e){if(console.log(e),this.options=e,e.hasOwnProperty("scene"))if(new RegExp(/u_id/g).test(decodeURI(e.scene))){var t=Object.fromEntries(decodeURIComponent(e.scene).split("&").map((function(e){return e.split("=")})));this.setData({id:t.id,l_id:t.l_id,u_id:t.u_id}),t=null}else this.setData({id:e.scene});else this.setData({id:e.id||this.scene,group_id:e.tuan_id||0,interFlag:!1,appid:a.liveappid,top:wx.getMenuButtonBoundingClientRect().top,height:wx.getMenuButtonBoundingClientRect().height});console.log(this.id),this.getLive(),wx.setNavigationBarTitle({title:"商品详情"}),this.getData(),this.getGoodsInfo(),this.getBottom(),this.getHeader()},onHide:function(){this.setData({show:!1,interFlag:!0})},onUnload:function(){this.setData({interFlag:!0})},onShareAppMessage:function(){return{title:"".concat(this.goodsName),path:"/pages/goodsItem/goodsItem/goodsItem?id=".concat(this.id,"&user_id=").concat(e.getStorageSync("user").id,"&leader_id=").concat(e.getStorageSync("area_id")),imageUrl:this.shareimg}},methods:{getLive:function(){var e=this;this.http({url:"shopLive",data:{status:1},noLogin:!0}).then((function(t){e.setData({roomid:t.data.roomid})}))},getData:function(){var t=this;this.http({url:"shopGoods/".concat(this.id),data:{key:e.getStorageSync("shopkey"),leader_id:e.getStorageSync("area_id")||0}}).then((function(o){if(t.setData({banner:o.data.pic_urls,price:o.data.price,goodsName:o.data.name,kdf:o.data.kdf,monthSale:o.data.totalSale.total,label:o.data.label,stocks:o.data.stocks,is_flash_sale:parseInt(o.data.is_flash_sale),line_price:o.data.line_price,short_name:o.data.short_name,max_price:Number(o.data.max_group_price)||Number(o.data.max_price),min_price:Number(o.data.min_group_price)||Number(o.data.min_price),end_time:o.data.end_time||"",start_time:o.data.start_time||"",send_time:o.data.send_time||"",avatar:o.data.avatar,totalSale:o.data.totalSale.num,video_url:o.data.video_url,video_pic_url:o.data.video_pic_url,video_status:o.data.video_status,simple_info:o.data.simple_info,is_group:1==o.data.is_open_assemble,goodstype:0==o.data.is_open_assemble?1==o.data.is_flash_sale?1:0:2,older_with_newer:!!o.data.group&&1==o.data.group.older_with_newer,open_group_preferential:!!o.data.group&&(1==o.data.group.is_leader_discount&&1==o.data.group.is_show),group_type:o.data.group?1==o.data.group.type?o.data.group.number+"人团":"阶梯团":"",property:Object.keys(o.data.property),service_goods_is_ship:o.data.service_goods_is_ship,type:o.data.type,attribute:o.data.attribute,is_info_header:e.getStorageSync("Config").is_info_header,supplier_id:o.data.supplier_id,supplier_name:o.data.supplier_name,data:o.data,bg:e.getStorageSync("background"),look:o.data.look}),t.options.hasOwnProperty("secne")){var n=Object.fromEntries(decodeURIComponent(t.options.scene).split("&").map((function(e){return e.split("=")})));wx.setStorageSync("shareInfo",{sharePeople_id:n.u_id,leader_id:t.options.obj.l_id})}t.options.hasOwnProperty("user_id")&&wx.setStorageSync("shareInfo",{sharePeople_id:t.options.user_id,leader_id:t.options.leader_id}),t.options.hasOwnProperty("tuan_id")&&t.setData({show:!0,btnStatus:"buy",tuanNum:e.getStorageSync("tuanNum"),submit_type:1}),t.drawImage()}))},getGoodsInfo:function(){var t=this;this.http({url:"shopGoodsinfo/".concat(this.id),data:{key:e.getStorageSync("shopkey")}}).then((function(e){t.setData({html:e.data.detail_info})}))},showLayer:function(e){console.log(e.detail);try{this.setData({show:!0,btnStatus:e.detail.status,tuanNum:e.detail.tuanNum,submit_type:e.detail.submit_type})}catch(t){this.setData({show:!0,btnStatus:e.detail.status})}},colseLayer:function(){this.setData({show:!1,btnStatus:"",tuanNum:0,group_id:this.options.tuan_id||0})},getjwt:function(){},showShare:function(){this.setData({shareFlag:!this.shareFlag})},setTuanId:function(e){this.setData({group_id:e.detail.groupid})},onShareTimeline:function(){return{title:"".concat(this.goodsName),path:"/pages/goodsItem/goodsItem/goodsItem?id=".concat(this.id,"&user_id=").concat(e.getStorageSync("user").id,"&leader_id=").concat(e.getStorageSync("area_id")),imageUrl:this.shareimg}},getBottom:function(){var t=this;e.getStorageSync("Config").is_info_bottom&&this.http({url:"shopDiy",data:{key:"info_bottom"},noLogin:!0}).then((function(e){t.setData({info_bottom:e.data})}))},getHeader:function(){var t=this;e.getStorageSync("Config").is_info_header&&this.http({url:"shopDiy",data:{key:"info_header"},noLogin:!0}).then((function(e){t.setData({info_header:e.data})}))},back:function(){wx.navigateBack({})},drawImage:function(){var t=this,o=wx.createSelectorQuery();console.log("开始绘制",o.select("#shareimg").fields({node:!0,size:!0})),o.select("#shareimg").fields({node:!0}).exec(function(){var o=r(n.default.mark((function o(a){var i,s,r,d;return n.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return console.log("正在绘制"),i=a[0].node,s=i.getContext("2d"),r=wx.getSystemInfoSync().pixelRatio,console.log(r),i.width=375,i.height=302,console.log(i),o.next=10,t.drawimgtocanvas(i,s,t.banner[0],{x:0,y:0,width:i.width,height:i.width});case 10:return o.next=12,t.drawimgtocanvas(i,s,"/static/images/goodsItem/bottom.png",{x:0,y:i.height-79,width:i.width,height:79});case 12:console.log("图片绘制完成"),s.beginPath(),s.fillStyle="white",s.fillRect(26,272,66,22),s.arc(26,283,11,0,2*Math.PI,!1),s.arc(92,283,11,0,2*Math.PI,!1),s.fill(),s.closePath(),console.log("按钮样式绘制完成"),s.textAlign="start",s.textBaseline="top",s.fillStyle="white",s.font="20px sans-serif",s.fillText("￥",16,242),s.font="bold 28px sans-serif",s.fillText(t.data.min_price,35,235),d=1==t.data.min_price.split(".").length?24*t.data.min_price.length+35:24*(t.data.min_price.length-1)+35,s.font="12px sans-serif",s.fillText("￥".concat(t.line_price),d,247),s.beginPath(),s.strokeStyle="white",s.moveTo(d-2,252),s.lineTo(8*t.line_price.length+12+d-2,252),s.fill(),s.stroke(),s.closePath(),s.font="18px sans-serif",s.fillText("剩余".concat(t.stocks,"件"),111,275),s.font="14px sans-serif",s.fillStyle="#fd360a",s.fillText("已售",26,278),s.fillText(t.data.monthSale||0,54,278),s.fillStyle="#994F00",s.textAlign="end",s.font="24px sans-serif",s.fillText(t.look,350,240),s.font="18px sans-serif",s.fillText("人气值",350,275),console.log("文字绘制完成"),wx.canvasToTempFilePath({canvas:i,width:i.width,height:i.height,destHeight:302*r,destWidth:375*r,x:0,y:0,quality:0,success:function(o){console.log(o.tempFilePath),setTimeout((function(){wx.uploadFile({url:"".concat(e.getStorageSync("url"),"uploads"),filePath:o.tempFilePath,header:{"Access-Token":e.getStorageSync("jwt")},name:"pic_url",success:function(e){console.log(e);var o=JSON.parse(e.data);200==o.status&&t.setData({shareimg:o.data})}})}),200)}});case 52:case"end":return o.stop()}}),o)})));return function(e){return o.apply(this,arguments)}}())},drawimgtocanvas:function(e,t,o,a){return r(n.default.mark((function i(){return n.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.abrupt("return",new Promise((function(n){var i=e.createImage();i.src=o,i.onload=function(e){t.drawImage(i,a.x,a.y,a.width,a.height),n("绘制 ".concat(o," 完毕"))}})));case 1:case"end":return n.stop()}}),i)})))()},pre:function(){wx.previewImage({urls:[this.shareimg]})}}};t.default=k}).call(this,o("543d")["default"])},"813c":function(e,t,o){"use strict";o.r(t);var n=o("9b85"),a=o("d2fc");for(var i in a)"default"!==i&&function(e){o.d(t,e,(function(){return a[e]}))}(i);o("a2be");var s,r=o("f0c5"),d=Object(r["a"])(a["default"],n["b"],n["c"],!1,null,"3f95bfb6",null,!1,n["a"],s);t["default"]=d.exports},"9b85":function(e,t,o){"use strict";var n,a=function(){var e=this,t=e.$createElement;e._self._c},i=[];o.d(t,"b",(function(){return a})),o.d(t,"c",(function(){return i})),o.d(t,"a",(function(){return n}))},a2be:function(e,t,o){"use strict";var n=o("4e9e"),a=o.n(n);a.a},d2fc:function(e,t,o){"use strict";o.r(t);var n=o("7e18"),a=o.n(n);for(var i in n)"default"!==i&&function(e){o.d(t,e,(function(){return n[e]}))}(i);t["default"]=a.a},d3a1:function(e,t,o){"use strict";(function(e){o("cd90");n(o("66fd"));var t=n(o("813c"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,o("543d")["createPage"])}},[["d3a1","common/runtime","common/vendor"]]]);