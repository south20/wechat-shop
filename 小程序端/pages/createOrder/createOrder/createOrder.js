(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/createOrder/createOrder/createOrder"],{"059b":function(e,t,a){"use strict";a.r(t);var o=a("6880"),n=a("8c3e");for(var r in n)"default"!==r&&function(e){a.d(t,e,(function(){return n[e]}))}(r);a("78ff");var i,s=a("f0c5"),d=Object(s["a"])(n["default"],o["b"],o["c"],!1,null,"34bd9368",null,!1,o["a"],i);t["default"]=d.exports},4764:function(e,t,a){"use strict";(function(e){function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;getApp();var n=function(){a.e("pages/createOrder/goods/goods").then(function(){return resolve(a("9b15"))}.bind(null,a)).catch(a.oe)},r=function(){a.e("pages/createOrder/coupons/coupons").then(function(){return resolve(a("53dc"))}.bind(null,a)).catch(a.oe)},i=function(){a.e("pages/createOrder/aogTime/aogTime").then(function(){return resolve(a("d94f"))}.bind(null,a)).catch(a.oe)},s=function(){a.e("pages/createOrder/tab/tab/tab").then(function(){return resolve(a("7f70"))}.bind(null,a)).catch(a.oe)},d=function(){a.e("pages/model/model").then(function(){return resolve(a("9530"))}.bind(null,a)).catch(a.oe)},c=function(){a.e("pages/footer/footer").then(function(){return resolve(a("2175"))}.bind(null,a)).catch(a.oe)},u={data:function(){return{goodsData:[],data:{user_contact_id:"",goods:"",voucher_id:"",remark:"",allPrice:0,orderPrice:0,openid:e.getStorageSync("openid")},address:[],youfei:"",page:!1,background:"#ff0000",modelFlag:!1,modelData:[{name:"姓名",data:""},{name:"电话",data:""}],tabFlag:!1,goodstype:0,tuanexpress:0,distribution:0,is_vip:!1,discount_ratio:1,pay_type:2,recharge_balance:0,balance_pay_is_open:!1,is_estimated:!1,estimated_service_time:"",user_contact_id:0,user_name:"",user_phone:"",session:"",useraddressid:0,flag:!1,allPrice:"",discount:{},options:{}}},components:{goods:n,coupons:r,aogTime:i,tab:s,model:d,diyfooter:c},props:{},onShow:function(){this.getSession(),this.getUserInfo(),wx.setNavigationBarTitle({title:"确认订单"}),this.setData({balance_pay_is_open:e.getStorageSync("Config").balance_pay,tabFlag:!0,background:e.getStorageSync("background"),goodsData:e.getStorageSync("shopcartData"),is_vip:1==e.getStorageSync("user").is_vip,user_phone:e.getStorageSync("user").phone,user_name:e.getStorageSync("user").name,modelData:[{name:"姓名",data:e.getStorageSync("user").name},{name:"电话",data:e.getStorageSync("user").phone}],is_estimated:1==e.getStorageSync("Config").estimated_service_time_info.is_estimated})},onLoad:function(e){this.options=e},onHide:function(){this.setData({tabFlag:!1})},onUnload:function(){this.setData({tabFlag:!1})},methods:{changeAddress:function(t){var a;console.error("createOrder",t.detail),this.setData((a={modelData:t.detail.address},o(a,"data.user_contact_id",t.detail.user_contact_id),o(a,"useraddressid",t.detail.useraddressid),o(a,"user_contact_id",t.detail.user_contact_id),o(a,"tuanexpress",e.getStorageSync("area").tuan_express_fee),a))},shopOrderPayXcx:function(e){this.setData({modelFlag:!0})},toOrder:function(t){var a=this;if(0!=this.goodstype&&!e.getStorageSync("area_id"))return wx.showModal({title:"温馨提醒",content:"您未选择".concat(e.getStorageSync("leader_name"),",无法使用团购功能,是否选择").concat(e.getStorageSync("leader_name")),success:function(e){e.confirm&&wx.navigateTo({url:"/group/changegroup/changegroup/changegroup"})}}),!1;var o={},n=[e.getStorageSync("SubscribeTemplateId")["send_goods"],e.getStorageSync("SubscribeTemplateId")["merchandise_arrival"],e.getStorageSync("SubscribeTemplateId")["pick_up_notice"]];if(o={goods:JSON.stringify(this.goodsData),type:this.goodstype,leader_id:e.getStorageSync("area_id")||0},0!=e.getStorageSync("tuanNum")&&(o.group_type=1,o.number=e.getStorageSync("tuanNum"),o.group_id=this.options.group_id||0,n[1]=e.getStorageSync("SubscribeTemplateId")["assemble"],n[2]=e.getStorageSync("SubscribeTemplateId")["pick_up_notice"]),1==e.getStorageSync("advance_sale")&&(o.advance_sale=1,n[1]=e.getStorageSync("SubscribeTemplateId")["presale"],n[2]=e.getStorageSync("SubscribeTemplateId")["merchandise_arrival"]),this.options.bargin_id&&(o.bargin_id=this.options.bargin_id),1==this.goodstype){try{if(0===this.user_name.trim().length)return wx.showToast({title:"请填写用户姓名",icon:"none"}),!1}catch(r){return wx.showToast({title:"请填写用户姓名",icon:"none"}),!1}try{if(0===this.user_phone.trim().length)return wx.showToast({title:"请填写手机号",icon:"none"}),!1}catch(r){return wx.showToast({title:"请填写手机号",icon:"none"}),!1}o.name=this.user_name,o.phone=this.user_phone,o.user_contact_id=0}else if(o.user_contact_id=0!=this.useraddressid?this.useraddressid:this.user_contact_id,void 0==o.user_contact_id)return wx.showToast({title:"请选择收货地址",icon:"none"}),!1;e.getStorageSync("Config").estimated_service_time_info.hasOwnProperty("is_estimated")&&1==e.getStorageSync("Config").estimated_service_time_info.is_estimated&&(o.estimated_service_time=this.estimated_service_time),e.getStorageSync("SubscribeTemplateId")["merchandise_arrival"]?wx.requestSubscribeMessage({tmplIds:n,success:function(e){a.postSubscribeMessage(e),wx.showLoading({title:"订单提交中"}),a.orderPay(o)},fail:function(e){wx.showLoading({title:"订单提交中"}),a.orderPay(o)}}):(wx.showLoading({title:"订单提交中"}),this.orderPay(o))},orderPay:function(e){var t=this;this.http({url:"shopOrderPay1",data:e,method:"post"}).then((function(e){wx.setStorageSync("group_id",e.data.group_id),e.data.hasOwnProperty("bool")&&1==e.data.bool?wx.redirectTo({url:"/pages/gopay/gopay?order_sn=".concat(e.data.order_sn,"&order_price=").concat(t.allPrice,"&group_id=").concat(e.data.group_id,"&group_number=").concat(e.data.group_number,"&is_advance_sale=1")}):t.options.hasOwnProperty("solitaire")?wx.redirectTo({url:"/pages/gopay/gopay?order_sn=".concat(e.data.order_sn,"&order_price=").concat(t.allPrice,"&group_id=").concat(e.data.group_id,"&group_number=").concat(e.data.group_number,"&solitaire=").concat(t.options.solitaire)}):wx.redirectTo({url:"/pages/gopay/gopay?order_sn=".concat(e.data.order_sn,"&order_price=").concat(t.allPrice,"&group_id=").concat(e.data.group_id,"&group_number=").concat(e.data.group_number)})}))},error:function(){this.setData({modelFlag:!1})},ok:function(){this.setData({modelFlag:!1}),this.toOrder()},footerFlag:function(e){this.setData({flag:!0})},goodstypeFun:function(t){this.setData({goodstype:1==t.detail.type?1:2==t.detail.type?2:0,tuanexpress:e.getStorageSync("area").tuan_express_fee,user_contact_id:1==t.detail.type?1:2==t.detail.type?2:t.detail.useraddressid,useraddressid:t.detail.useraddressid}),this.update()},change_pay_type:function(e){this.setData({pay_type:e.detail.value})},getUserInfo:function(){var e=this;this.http({url:"shopUserInfo"}).then((function(t){e.setData({recharge_balance:t.data.recharge_balance,user_name:t.data.name})}))},chooseEstimated:function(e){this.setData({estimated_service_time:e.detail.estimated_service_time})},setCoupons:function(e){this.goodsData=e.detail.data,this.update()},update:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};console.log(t);var a={goods:JSON.stringify(t.hasOwnProperty("detail")?t.detail.data:this.goodsData),type:this.goodstype,leader_id:wx.getStorageSync("area_id")||0};0!=wx.getStorageSync("tuanNum")&&(a.group_type=1,a.number=wx.getStorageSync("tuanNum"),a.group_id=this.options.group_id||0),1==wx.getStorageSync("advance_sale")&&(a.advance_sale=1),this.options.bargin_id&&(a.bargin_id=this.options.bargin_id),1!=this.data.goodstype&&(a.user_contact_id=0!=this.useraddressid?this.useraddressid:this.user_contact_id),this.http({url:"shopPayOrderInfo",data:a,method:"post"}).then((function(a){var o=0;for(var n in a.data)a.data[n]=a.data[n].order,console.log(a.data[n]),o+=Number(a.data[n].payment_money),o+=Number(a.data[n].express_price);e.allPrice=Math.round(100*o)/100,e.discount=a.data,t.hasOwnProperty("detail")&&(e.goodsData=t.detail.data)}))},changename:function(e){console.log(e.detail),this.setData({user_name:e.detail.data,modelData:[{name:"姓名",data:e.detail.data},{name:"手机号",data:this.user_phone}]})},changephone:function(e){this.setData({user_phone:e.detail.data,modelData:[{name:"姓名",data:this.user_name},{name:"手机号",data:e.detail.data}]})},getSession:function(){var t=this;wx.login({success:function(a){t.http({url:"shopTuanMiniprogramr",data:{code:a.code,key:e.getStorageSync("shopkey"),type:"miniprogram"}}).then((function(e){t.setData({session:e.data.session_key})}))}})}}};t.default=u}).call(this,a("543d")["default"])},6880:function(e,t,a){"use strict";var o,n=function(){var e=this,t=e.$createElement;e._self._c},r=[];a.d(t,"b",(function(){return n})),a.d(t,"c",(function(){return r})),a.d(t,"a",(function(){return o}))},"78ff":function(e,t,a){"use strict";var o=a("ea81"),n=a.n(o);n.a},"7cd0":function(e,t,a){"use strict";(function(e){a("cd90");o(a("66fd"));var t=o(a("059b"));function o(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,a("543d")["createPage"])},"8c3e":function(e,t,a){"use strict";a.r(t);var o=a("4764"),n=a.n(o);for(var r in o)"default"!==r&&function(e){a.d(t,e,(function(){return o[e]}))}(r);t["default"]=n.a},ea81:function(e,t,a){}},[["7cd0","common/runtime","common/vendor"]]]);